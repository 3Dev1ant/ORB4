<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="../css/main.css">
    <script src="/jquery"></script>
    <script>
        function sendJson(obj) {
            var str = JSON.stringify(obj);
            var request = new XMLHttpRequest();
            request.open("PATCH", `/engine/settings?p=${str}`, false);
            request.send();
        }

        function updateSettings() {
            var request = new XMLHttpRequest();
            request.open("GET", `/engine/settings`, false);
            request.send();

            var obj = JSON.parse(request.responseText);
            for (var i = 0; i < obj.length; i++) {
                var setting = obj[i];

                var id = setting.id;
                var value = setting.value;
                var checked = undefined;

                if (setting.checked != undefined)
                    checked = setting.checked.toLowerCase();;

                var element = document.getElementById(id);

                try {
                    element.checked = (checked == 'true');
                } catch (err) {
                    try {
                        element.value = value;
                    } catch (err2) {
                        continue;
                    }

                    continue;
                }

                try {
                    element.value = value;
                } catch (err) {
                    continue;
                }
            }

            updateAnyDifficultySwitch();
            updateAnyLengthSwitch();
        }

        $(document).on('contextmenu', function (e) {
            if (!$(e.target).is("#api_key"))
                return false;
        });
        
        function playSound(name){
            setTimeout(function(){
                var request = new XMLHttpRequest();
                    request.open("GET", `/sounds/play?id=${name}`, false);
                    request.send();
            }, 1);
        }

        function onChange(element) {
            var id = element.getAttribute('id');
            var type = element.getAttribute('type');

            if (id == "api_key") {
                cSharpTools.registerApiKey(element.value);
                updateSettings();
                return;
            }

            if (type == "checkbox")
                playSound("Switch");

            sendJson({ "setting_id": id, "type": type, "value": element.value, "checked": element.checked });
            updateSettings();
        }
    </script>
</head>

<body onload="updateSettings()" style="overflow-y: scroll">

    <div id="settingsTitle" class="settings-title" style="opacity: 1;">Settings</div>

    <div class="setting" >
            <div class="onoffswitch">
                <input onchange="onChange(this)" type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="sound_effects">
                <label class="onoffswitch-label" for="sound_effects"></label>
            </div> &nbsp;&nbsp;&nbsp; Sound effects
        </div>
    
    <div class="setting" style="margin-top:15px">
        API key &nbsp; &nbsp;
        <input onchange="onChange(this)" id="api_key" type="password" style="width: 100px;">
    </div>
    <a style="font-size: 12px; -webkit-user-drag: none; display: block; text-align: left; margin-top: 9px; margin-left: 25px"
        onclick="cSharpTools.openUrl('https://osu.ppy.sh/p/api');" href="#">Get your API key here.</a>

    <div class="setting" style="margin-top:15px">
        <div class="onoffswitch">
            <input onchange="onChange(this)" type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="auto_open">
            <label class="onoffswitch-label" for="auto_open"></label>
        </div> &nbsp;&nbsp;&nbsp; Auto open
    </div>

    <div class="setting" style="margin-top:2px">
        <div class="onoffswitch">
            <input onchange="onChange(this)" type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="open_in_game">
            <label class="onoffswitch-label" for="open_in_game"></label>
        </div> &nbsp;&nbsp;&nbsp; Open in game
    </div>

    <div class="settings-group" style="margin-top: 20px;">Search criteria</div>

    <div class="setting" style="margin-top:20px">
        <div class="onoffswitch">
            <input onchange="onChange(this)" type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="old_beatmaps">
            <label class="onoffswitch-label" for="old_beatmaps"></label>
        </div> &nbsp;&nbsp;&nbsp;
        <div class="tooltip">
            Old beatmaps
            <span class="tooltiptext">Before 2011</span>
        </div>
    </div>

    <hr>

    <div class="setting" style="margin-top:20px">
        <div class="onoffswitch">
            <input onchange="anyDifficultySwitch(this)" type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="any_difficulty">
            <label class="onoffswitch-label" for="any_difficulty"></label>
        </div> &nbsp;&nbsp;&nbsp; Any difficulty
    </div>

    <script>
        function updateAnyDifficultySwitch() {
            if (document.getElementById("any_difficulty").checked) {
                document.getElementById("max_stars").disabled = true;
                document.getElementById("min_stars").disabled = true;
            } else {
                document.getElementById("max_stars").disabled = false;
                document.getElementById("min_stars").disabled = false;
            }
        }

        function anyDifficultySwitch(element) {
            onChange(element);

            if (element.checked) {
                document.getElementById("max_stars").disabled = true;
                document.getElementById("min_stars").disabled = true;
            } else {
                document.getElementById("max_stars").disabled = false;
                document.getElementById("min_stars").disabled = false;
            }
        }
    </script>

    <div class="setting" style="margin-top:10px">
        Max stars
        <input id="max_stars" onchange="onChange(this)" type="number" style="margin-left: 10px;" value="100" />
    </div>

    <div class="setting" style="margin-top:10px; margin-bottom: 25px">
        Min stars
        <input id="min_stars" onchange="onChange(this)" type="number" style="margin-left: 13.5px;" value="0" />
    </div>

    <hr>

    <div class="setting" style="margin-top:10px">
        <div class="onoffswitch">
            <input onchange="anyLengthSwitch(this)" type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="any_length">
            <label class="onoffswitch-label" for="any_length"></label>
        </div> &nbsp;&nbsp;&nbsp; Any length
    </div>

    <script>
        function updateAnyLengthSwitch() {
            if (document.getElementById("any_length").checked) {
                document.getElementById("max_length").disabled = true;
                document.getElementById("min_length").disabled = true;
            } else {
                document.getElementById("max_length").disabled = false;
                document.getElementById("min_length").disabled = false;
            }
        }

        function anyLengthSwitch(element) {

            onChange(element);

            if (element.checked) {
                document.getElementById("max_length").disabled = true;
                document.getElementById("min_length").disabled = true;
            } else {
                document.getElementById("max_length").disabled = false;
                document.getElementById("min_length").disabled = false;
            }
        }
    </script>

    <div class="setting" style="margin-top:10px">
        Max length
        <input id="max_length" onchange="onChange(this)" type="number" style="margin-left: 10px;" value="600" />
    </div>

    <div class="setting" style="margin-top:10px;">
        Min length
        <input id="min_length" onchange="onChange(this)" type="number" style="margin-left: 13.5px;" value="0" />
    </div>

    <div class="settings-group" style="margin-top: 30px; font-family: NotoRegular; font-size: 18px">Ranking status</div>

    <div class="setting" style="margin-top:15px">
        <div class="onoffswitch">
            <input onchange="onChange(this)" type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="loved">
            <label class="onoffswitch-label" for="loved"></label>
        </div> &nbsp;&nbsp;&nbsp; Loved
    </div>

    <div class="setting" style="margin-top:2px">
        <div class="onoffswitch">
            <input onchange="onChange(this)" type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="qualified" checked>
            <label class="onoffswitch-label" for="qualified"></label>
        </div> &nbsp;&nbsp;&nbsp; Qualified
    </div>

    <div class="setting" style="margin-top:2px">
        <div class="onoffswitch">
            <input onchange="onChange(this)" type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="approved" checked>
            <label class="onoffswitch-label" for="approved"></label>
        </div> &nbsp;&nbsp;&nbsp; Approved
    </div>

    <div class="setting" style="margin-top:2px">
        <div class="onoffswitch">
            <input onchange="onChange(this)" type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="ranked" checked>
            <label class="onoffswitch-label" for="ranked"></label>
        </div> &nbsp;&nbsp;&nbsp; Ranked
    </div>

    <div class="setting" style="margin-top:2px">
        <div class="onoffswitch">
            <input onchange="onChange(this)" type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="pending">
            <label class="onoffswitch-label" for="pending"></label>
        </div> &nbsp;&nbsp;&nbsp; Pending
    </div>

    <div class="setting" style="margin-top:2px">
        <div class="onoffswitch">
            <input onchange="onChange(this)" type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="wip">
            <label class="onoffswitch-label" for="wip"></label>
        </div> &nbsp;&nbsp;&nbsp; WIP
    </div>

    <div class="setting" style="margin-top:2px">
        <div class="onoffswitch">
            <input onchange="onChange(this)" type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="graveyarded">
            <label class="onoffswitch-label" for="graveyarded"></label>
        </div> &nbsp;&nbsp;&nbsp; Graveyarded
    </div>

    <div class="settings-group" style="margin-top: 30px; font-family: NotoRegular; font-size: 18px">Modes</div>

    <div class="setting" style="margin-top:15px">
        <div class="onoffswitch">
            <input onchange="onChange(this)" type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="standard" checked>
            <label class="onoffswitch-label" for="standard"></label>
        </div> &nbsp;&nbsp;&nbsp; Standard
    </div>

    <div class="setting" style="margin-top:2px">
        <div class="onoffswitch">
            <input onchange="onChange(this)" type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="taiko">
            <label class="onoffswitch-label" for="taiko"></label>
        </div> &nbsp;&nbsp;&nbsp; Taiko
    </div>

    <div class="setting" style="margin-top:2px">
        <div class="onoffswitch">
            <input onchange="onChange(this)" type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="catch_the_beat">
            <label class="onoffswitch-label" for="catch_the_beat"></label>
        </div> &nbsp;&nbsp;&nbsp; Catch The Beat
    </div>

    <div class="setting" style="margin-top:2px">
        <div class="onoffswitch">
            <input onchange="onChange(this)" type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="mania">
            <label class="onoffswitch-label" for="mania"></label>
        </div> &nbsp;&nbsp;&nbsp; Mania
    </div>

    <div class="settings-group" style="margin-top: 30px; font-family: NotoRegular; font-size: 18px">Genres</div>

    <div class="setting" style="margin-top:15px">
        <div class="onoffswitch">
            <input onchange="onChange(this)" type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="unspecified" checked>
            <label class="onoffswitch-label" for="unspecified"></label>
        </div> &nbsp;&nbsp;&nbsp; Unspecified
    </div>

    <div class="setting" style="margin-top:2px">
        <div class="onoffswitch">
            <input onchange="onChange(this)" type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="video_game" checked>
            <label class="onoffswitch-label" for="video_game"></label>
        </div> &nbsp;&nbsp;&nbsp; Video Game
    </div>

    <div class="setting" style="margin-top:2px">
        <div class="onoffswitch">
            <input onchange="onChange(this)" type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="anime" checked>
            <label class="onoffswitch-label" for="anime"></label>
        </div> &nbsp;&nbsp;&nbsp; Anime
    </div>

    <div class="setting" style="margin-top:2px">
        <div class="onoffswitch">
            <input onchange="onChange(this)" type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="rock" checked>
            <label class="onoffswitch-label" for="rock"></label>
        </div> &nbsp;&nbsp;&nbsp; Rock
    </div>

    <div class="setting" style="margin-top:2px">
        <div class="onoffswitch">
            <input onchange="onChange(this)" type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="pop" checked>
            <label class="onoffswitch-label" for="pop"></label>
        </div> &nbsp;&nbsp;&nbsp; Pop
    </div>

    <div class="setting" style="margin-top:2px">
        <div class="onoffswitch">
            <input onchange="onChange(this)" type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="hip_hop" checked>
            <label class="onoffswitch-label" for="hip_hop"></label>
        </div> &nbsp;&nbsp;&nbsp; Hip Hop
    </div>

    <div class="setting" style="margin-top:2px">
        <div class="onoffswitch">
            <input onchange="onChange(this)" type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="novelty" checked>
            <label class="onoffswitch-label" for="novelty"></label>
        </div> &nbsp;&nbsp;&nbsp; Novelty
    </div>

    <div class="setting" style="margin-top:2px">
        <div class="onoffswitch">
            <input onchange="onChange(this)" type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="electronic" checked>
            <label class="onoffswitch-label" for="electronic"></label>
        </div> &nbsp;&nbsp;&nbsp; Electronic
    </div>

    <div class="setting" style="margin-top:2px">
        <div class="onoffswitch">
            <input onchange="onChange(this)" type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="other" checked>
            <label class="onoffswitch-label" for="other"></label>
        </div> &nbsp;&nbsp;&nbsp; Other
    </div>

    <div style="width: 100%; height: 50px;"></div>
</body>

</html>